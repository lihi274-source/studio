{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user account within the travel agency application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "username": {
          "type": "string",
          "description": "The username of the user account."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The 'id' field MUST match the Firebase Auth 'uid'. Includes 'id', 'username', and 'email'. Authorization rules will enforce that only the user with the matching 'userId' can read and write their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Auth 'uid'."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage user profiles for the Viajes Explorador travel agency application. It uses path-based ownership for user profiles, ensuring data privacy and simplified security rules.  Specifically, user profiles are stored under the `/users/{userId}` path. This structure supports Authorization Independence because all data related to a user is directly accessible through their `userId` without needing to fetch data from other collections to validate permissions. It supports the QAPs because listing operations can be easily secured using the user's ID. Only the authenticated user (or an admin with appropriate roles - to be implemented later if required) should be able to read/write data under their `/users/{userId}` path. The 'id' field from the UserProfile entity is not automatically populated by Firestore. It is expected that the client application will populate this value with the Firebase Auth `uid` value, which is available on login via `request.auth.uid`. The `id` is explicitly included in the data to promote data consistency and readability."
  }
}